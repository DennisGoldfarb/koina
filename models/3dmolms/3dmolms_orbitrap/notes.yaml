description: |
  The 3DMolMS model is a deep neural network that predicts tandem mass spectrometry (MS/MS) spectra from the 3D conformations of chemical compounds. The goal of the model is to improve compound identification in untargeted metabolomics.
  The 3DMolMS model consists of an encoder and a decoder. The encoder takes as input a point set representation of the 3D conformation of a compound. This point set is generated by using the ETKDG algorithm to generate a 3D conformer of the compound and then encoding each atom in the conformer as a point. Each point is represented by a vector of 21 dimensions, which includes the x, y, and z coordinates of the atom, as well as a number of other attributes, such as the atom type, the number of neighbors, and the atomic mass. The encoder then uses six 3DMolConv-based hidden layers to extract features from the input point set. The decoder takes the output of the encoder and uses five fully connected layers to predict the MS/MS spectrum of the compound.
  **Data**
  Source of Data: The model was trained using approximately 70,000 MS/MS spectra from the Agilent Personal Compound Database and Library (PCDL) and the NIST20 spectral library.
  Type of Molecules: The training data covers a broad range of chemical compounds relevant to untargeted metabolomics. This is not limited to a single class but includes a diverse set of metabolites typically encountered in metabolomics studies.
  Representation of Molecular Complexity: The training set is drawn from libraries that contain spectra from a large number of compounds, suggesting that it covers a broad spectrum of molecular diversity. However, because these spectra were acquired under similar instrument conditions, the training data might not fully capture the variability and complexity seen in real-world experiments that use different instruments or settings.
  Limitations of Training Data: Since the training spectra come from libraries with similar instrument settings, the model may be less robust when applied to data acquired under different conditions or using different instruments. While the training set covers a wide range of metabolites, any biases in the library composition could still limit performance on underrepresented molecular classes.
  **Optimization**
  Optimization Target: 3DMolMS is optimized to predict the complete MS/MS spectrum of a compound. The training procedure minimizes the cosine distance (i.e., maximizes cosine similarity) between the predicted and experimental spectra.
  Metric: Cosine Similarity
  **Model**
  Interpretability: 3DMolMS is a black box.
  Model insights:  The latent features learned by the model are not only useful for predicting MS/MS spectra but have also been successfully transferred to predict other chemical properties like retention time (RT) and collision cross section (CCS) suggesting that the model captures meaningful chemical information.
  Model Type: Regression model. It outputs a continuous 1D spectral vector where each of the 7500 dimensions represents the transformed intensity
  Limitations: Fixed spectral resolution parameters.
  **Evaluation**
  Performance Measures: The model was evaluated using cosine similarity between the predicted and experimental spectra.
  Reason for Performance Measures: Metric Justification: Cosine similarity is chosen for its ability to capture spectral shape and relative intensities.
  Model Evaluation: The model was evaluated on spectra from the same libraries (PCDL and NIST20) as well as on an independent test set from the MassBank of North America (MoNA) library. The MoNA library contains spectra acquired from a variety of Q-TOF instruments, allowing for evaluation of the modelâ€™s generalizability to different instruments.
  Data Applicability: Optimized for small molecule MS/MS spectra within a fixed m/z range and specific pre-processing; performance may vary with different experimental setups.
  **Input notes**
  Supported precursor types are `["[M+H]+", "[M-H]-", "[M+H-H2O]+", "[M+Na]+", "[M+2H]2+"]`.
  Max number of atoms in the input molecule is 100 and min is 10.
  supported atoms are `["C", "O", "N", "H", "P", "S", "F", "Cl", "B", "Br", "I"]`
  **Output notes**
  The intensity result is normalized to the highest predicted intensity value in the spectrum (i.e., the maximum intensity is set to 1).
  The output has the resolution of 0.2 Da for the m/z range of 0-1500 Da (7500 bins).

citation: |
  3DMolMS: prediction of tandem mass spectra from 3D molecular conformations, 
  Yuhui Hong, Sujun Li, Christopher J Welch, Shane Tichy, Yuzhen Ye, Haixu Tang, 
  Bioinformatics, Volume 39, Issue 6, June 2023, btad354, https://doi.org/10.1093/bioinformatics/btad354
tag: "Metabolomics fragment intensity"
examples:
  inputs:
    [
      {
        "name": "smiles",
        "httpdtype": "BYTES",
        "data": '["CN1C=NC2=C1C(=O)N(C(=O)N2C)C"]',
        "shape": "[1,1]"
      },
      {
        "name": "precursor_types",
        "httpdtype": "BYTES",
        "data": '["[M+H]+"]',
        "shape": "[1,1]"
      },
      {
        "name": "collision_energies",
        "httpdtype": "FP32",
        "data": '[20]',
        "shape": "[1,1]"
      }
    ]
